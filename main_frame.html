<!DOCTYPE html>
  <html>
  <head>
  <meta charset="utf-8">
  <title>坦克大战</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
  body
  {
     background: url("image/background.png");
     background-repeat: no-repeat;
     background-size:100%;
  }
  </style>
  <style>
  div.one
  {
      position: absolute;
      top:0px;
      left:0px;
     
  }
  div.two
  {
      position: absolute;
      top:400px;
      left:0px;
     
  }
  button.button1
  {
    background-color: aquamarine; 
    border: none;
    color:gold;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    position: absolute;
    top:50px;
    left:50px;
  }
  button.button2
  {
    background-color: cadetblue; 
    border: none;
    color: gold;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    position: absolute;
    top:50px;
    left:200px;
  }
  button.button3
  {
    background-color: teal; 
    border: none;
    color: gold;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    position: absolute;
    top:50px;
    left:350px;
  }
  button.buttont
  {
    background-color: olivedrab; 
    border: none;
    color: gold;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    position: absolute;
    top:50px;
    left:500px;
  }
  button.buttonai
  {
    background-color: green; 
    border: none;
    color: gold;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    position: absolute;
    top:50px;
    left:650px;
  }
  p.life
  {
    font-size:30px;
    font-family:"Times New Roman";
    font-weight:bold;
    color: aqua;
  }
  input.room
  {
    border-color: #66afe9;
    outline: 0;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
    box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
    position: absolute;
    top:250px;
    left:50px;
    outline-style: none ;
    border: 1px solid #ccc; 
    border-radius: 3px;
    padding: 13px 14px;
    width: 620px;
    font-size: 14px;
    font-weight: 700;
    font-family: "Times New Roman";
    BACKGROUND-COLOR: transparent;
  }
  input.passport
  {
    border-color: #66afe9;
    outline: 0;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
    box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
    position: absolute;
    top:300px;
    left:50px;
    outline-style: none ;
    border: 1px solid #ccc; 
    border-radius: 3px;
    padding: 13px 14px;
    width: 620px;
    font-size: 14px;
    font-weight: 700;
    font-family: "Times New Roman";
    BACKGROUND-COLOR: transparent;
  }
  </style>
  </head>
  <body>
      <div class="one">
          <img src="" id="onei">
          <img src='' id="bullet">
          <img src="" id="twoi">
          <img src='' id="bullet22">
          <img src='' id="ai1">
          <img src='' id="ai2">
          <img src='' id="ai3">
          <img src='' id="ai4">
          <img src='' id="ai5">
          <img src='' id="aib1">
          <img src='' id="aib2">
          <img src='' id="aib3">
          <img src='' id="aib4">
          <img src='' id="aib5">
          <img src='' id="food">
          <button onclick="change_position1()" id="button1" class="button1">hard battle</button>
          <button onclick="change_position2()" id="button2" class="button2">medium battle</button>
          <button onclick="change_position3()" id="button3" class="button3">easy battle</button>
          <button onclick="change_positiont()" id="buttont" class="buttont">team battle</button>
          <button onclick="change_positionai()" id="buttonai" class="buttonai">aiteam battle</button>
          <input type="text" id="room" class="room">
          <input type="text" id="passport" class="passport">
          <audio controls autoplay loop id="bg3">
            <source src="music//background_music3.mp3" type="audio/mpeg">
          </audio>
          <audio controls autoplay loop id="bg2">
            <source src="music//background_music2.mp3" type="audio/mpeg">
          </audio>
          <audio controls autoplay loop id="bg1">
            <source src="music//background_music1.mp3" type="audio/mpeg">
          </audio>
          <audio controls autoplay id="boom">
            <source src="music/bang.wav" type="audio/mpeg">
          </audio>
          <audio controls autoplay id="start">
            <source src="music/start.wav" type="audio/mpeg">
          </audio>
      </div>
      <div class="two">
        <p id="lost"></p>
        <br>
        <p id="life" class="life"></p>
      </div>
  </body>
  <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
  <script>
          document.getElementById("bg1").style.display="none";
          document.getElementById("bg2").style.display="none";
          document.getElementById("bg3").style.display="none";
          document.getElementById("boom").style.display="none";
          document.getElementById("start").style.display="none";
          var x=300,y=100;
          var bx=12,by=12;
          var x22=300,y22=230;
          var bx22=0,by22=0;
          var is_bullet=false;
          var is_bullet22=false;
          var bdir22;
          var dir22=3;
          var bdir;
          var dir=3;
          var num_ai=0;
          var T=0;
          var life2;
          var ai_dir=[0,0,0,0,0,0,0];
          var ai_x=[0,0,0,0,0,0,0];
          var ai_y=[0,0,0,0,0,0,0];
          var ai_bx=[0,0,0,0,0,0,0];
          var ai_by=[0,0,0,0,0,0,0];
          var ai_bdir=[0,0,0,0,0,0,0];
          var ai_able_to_fire=[true,true,true,true,true,true,true];
          var life;
          var ai_survive=[true,false,false,false,false,false,false];
          var tempkeycode=0;
          var is_move=0;
          var last=10;
          var eatnum=0;
          var max_ai_num;
          if (window.WebSocket) {
                socket = new WebSocket("ws://localhost:8080/ws");        
            } 
          var ditu=[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,
          0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,
          0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,
          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
          0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,
          0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,
          0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,
          1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,
          0,0,0,0,0,0,1,0,0,0,3,0,0,0,0,
          0,5,5,5,0,0,1,0,0,0,0,0,0,0,1,
          0,5,5,5,0,0,0,0,0,0,0,0,0,0,0,
          0,5,5,5,0,0,0,0,0,0,0,0,0,0,0,
          0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
          0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,
          0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,];
          var now=[];
          var pre_now=[];
          var alert_before=0;
          var socket;
         var is_bullet2=true;
         var foodnum=0;
         var fdx,fdy;
         var time_freeze_time=0;
         function p2_eat_food()
         {
          document.getElementById("food").src="";
          if(foodnum==1)
          {
            life2+=5;
          }
          if(foodnum==2)
          {
            time_freeze_time=T;
          }
          if(foodnum==3)
          {
            for(i=1;i<=max_ai_num;i++)
            {
              strtemp="ai"+i.toString();
                      ai_survive[i]=false;
                      var xx=0,yy=0;
                      var temp1=document.getElementById(strtemp);
                          temp1.src="";
              
                          var temp=document.getElementById(strtemp);
                          var st="position: absolute;top:"+xx.toString()+"px;left:"+yy.toString()+"px;";
                          temp.style.cssText=st;
            }
            var audio = new Audio("music//bang.wav");
                      audio.play();
          }
          foodnum=0;

         }
         function p1_eat_food()
         {
          document.getElementById("food").src="";
          if(foodnum==1)
          {
            life+=5;
          }
          if(foodnum==2)
          {
            time_freeze_time=T;
            console.log("TF"+time_freeze_time.toString());
          }
          if(foodnum==3)
          {
            for(i=1;i<=max_ai_num;i++)
            {
              strtemp="ai"+i.toString();
                      ai_survive[i]=false;
                      var xx=0,yy=0;
                      var temp1=document.getElementById(strtemp);
                          temp1.src="";
              
                          var temp=document.getElementById(strtemp);
                          var st="position: absolute;top:"+xx.toString()+"px;left:"+yy.toString()+"px;";
                          temp.style.cssText=st;
            }
            var audio = new Audio("music//bang.wav");
                      audio.play();
          }
          foodnum=0;

         }
         function ai_battle_boomt()
          {
              for(i=1;i<=num_ai;i++)
              {
                var strtemp='aib'+i.toString();
                if(ai_able_to_fire[i])
                {
                  continue;
                }
                  if(ai_bx[i]-x22<=12&&ai_bx[i]-x22>=-12&&ai_by[i]-y22<=12&&ai_by[i]-y22>=-12)
                  {
                      life2--;
                      if(life2==0)
                      {
                          return;
                      }
                      ////console.log(life);
                      var  xx=300,yy=330;
                      var temp1=document.getElementById("twoi");
                          temp1.src="image//player1_tank_1_up.png"
                          //document.getElementById("onep").innerHTML="up";
                          var temp=document.getElementById("twoi");
                          var st="position: absolute;top:"+xx.toString()+"px;left:"+yy.toString()+"px;";
                          temp.style.cssText=st;
                          dir22=3
                          x22=300;
                          y22=330;
                          ai_able_to_fire[i]=true;
                          ai_by[i]=0;
                    ai_bx[i]=0;
                      var temp=document.getElementById(strtemp);
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById(strtemp);
                      temp.src="";
                  }
                  if(ai_bx[i]-x22<=12&&ai_bx[i]-x22>=-12&&ai_by[i]-y22<=12&&ai_by[i]-y22>=-12)
                  {
                      life2--;
                      if(life==0)
                      {
                          return;
                      }
                      ////console.log(life);
                      var  xx=300,yy=330;
                      var temp1=document.getElementById("twoi");
                          temp1.src="image//player1_tank_1_up.png"
                          //document.getElementById("onep").innerHTML="up";
                          var temp=document.getElementById("twoi");
                          var st="position: absolute;top:"+xx.toString()+"px;left:"+yy.toString()+"px;";
                          temp.style.cssText=st;
                          dir22=3
                          x22=300;
                          y22=330;
                          ai_able_to_fire[i]=true;
                          ai_by[i]=0;
                    ai_bx[i]=0;
                      var temp=document.getElementById(strtemp);
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById(strtemp);
                      temp.src="";
                  }
              }
          }
         function ai_movet()
         {
         
              if(T%2000==0&&last>0)
              {
                if(num_ai<max_ai_num)
                {
                  num_ai+=1;
                }
                var creat_num=0;
                for(j=1;j<=num_ai;j++)
                {
                  if(ai_survive[j]==false)
                  {
                    creat_num=j;
                    ai_survive[j]=true;
                  }
                }
                if(creat_num!=0)
                {
                  last--;
                  strtemp="ai"+creat_num.toString();
                  var temp1=document.getElementById(strtemp);
                  temp1.src="image//enemy_tank_down.png";
                  var temp=document.getElementById(strtemp);
                  var x=12;
                  var y=12;
                  var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                  temp.style.cssText=st;
                  ai_dir[creat_num]=4;
                  ai_x[creat_num]=12;
                  ai_y[creat_num]=12;
                }
                  
              }
              T+=100;
              for(i=1;i<=num_ai;i++)
              {
                if(ai_survive[i]==false)
                  {
                    continue;
                  }
                // var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                   //conshow+=",rands:"+(T/100).toString();
                   // //console.log(conshow);
                  
                  if(ai_x[i]-x<=12&&ai_x[i]-x>=-12&&ai_y[i]-y<=12&&ai_y[i]-y>=-12)//防碰撞
                  {
                      var tempdir=ai_dir[i];
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                         if(ai_dir[i]==tempdir)
                         {
                           ai_dir[i]=(tempdir+1)%4+1;
                         }
                         if(ai_dir[i]==1)
                          {
                              strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_left.png"
                            
                          }
                          if(ai_dir[i]==2)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_right.png"
                              ai_y[i]+=12;
                              
                          }
                          if(ai_dir[i]==3)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_up.png"
                        
                          }
                          if(ai_dir[i]==4)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_down.png"
                              
                          }
                  }
                  if(ai_x[i]-x22<=12&&ai_x[i]-x22>=-12&&ai_y[i]-y22<=12&&ai_y[i]-y22>=-12)//防碰撞
                  {
                      var tempdir=ai_dir[i];
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                         if(ai_dir[i]==tempdir)
                         {
                           ai_dir[i]=(tempdir+1)%4+1;
                         }
                         if(ai_dir[i]==1)
                          {
                              strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_left.png"
                            
                          }
                          if(ai_dir[i]==2)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_right.png"
                              ai_y[i]+=12;
                              
                          }
                          if(ai_dir[i]==3)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_up.png"
                        
                          }
                          if(ai_dir[i]==4)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_down.png"
                              
                          }
                  }
                  for(j=1;j<i;j++)//防碰撞
                  {
                    var xx=ai_x[j],yy=ai_y[j],ddir=ai_dir[j];
                    if(ai_x[i]-xx<=12&&ai_x[i]-xx>=-12&&ai_y[i]-yy<=12&&ai_y[i]-yy>=-12)
                    {
                        var tempdir=ai_dir[i];
                          ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                          if(ai_dir[i]==tempdir)
                          {
                            ai_dir[i]=ddir;
                          }
                          if(ai_dir[i]==1)
                            {
                                strtemp="ai"+i.toString();
                                var temp1=document.getElementById(strtemp);
                                temp1.src="image//enemy_tank_left.png"
                              
                            }
                            if(ai_dir[i]==2)
                            {
                              strtemp="ai"+i.toString();
                                var temp1=document.getElementById(strtemp);
                                temp1.src="image//enemy_tank_right.png"
                                
                            }
                            if(ai_dir[i]==3)
                            {
                              strtemp="ai"+i.toString();
                                var temp1=document.getElementById(strtemp);
                                temp1.src="image//enemy_tank_up.png"
                          
                            }
                            if(ai_dir[i]==4)
                            {
                              strtemp="ai"+i.toString();
                                var temp1=document.getElementById(strtemp);
                                temp1.src="image//enemy_tank_down.png"
                                
                            }
                    }
                  }
                  if(ai_x[i]<=0)
                  {
                    /*var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                    conshow+=",rands:"+(T/100).toString();
                      //console.log(conshow);*/
                      while(ai_dir[i]==3)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==3)
                        {
                          ai_dir[i]=4;
                        }
                      }
                      //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                      ////console.log(conshow);
                      if(ai_dir[i]==1)
                      {
                          strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_left.png"
                         
                      }
                      if(ai_dir[i]==2)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_right.png"
                          
                      }
                      if(ai_dir[i]==3)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_up.png"
                    
                      }
                      if(ai_dir[i]==4)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_down.png"
                          
                      }
                      
                  }
                  if(ai_x[i]>=336)
                  {
                    //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                   // conshow+=",rands:"+(T/100).toString();
                    //  //console.log(conshow);
                    while(ai_dir[i]==4)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==4)
                        {
                          ai_dir[i]=3;
                        }
                      }
                      //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                      ////console.log(conshow);
                      if(ai_dir[i]==1)
                      {
                          strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_left.png"
                         
                      }
                      if(ai_dir[i]==2)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_right.png"
                          
                      }
                      if(ai_dir[i]==3)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_up.png"
                    
                      }
                      if(ai_dir[i]==4)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_down.png"
                          
                      }
                      
                  }
                  if(ai_y[i]<=0)
                  {
                    //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                    //conshow+=",rands:"+(T/100).toString();
                     // //console.log(conshow);
                     while(ai_dir[i]==1)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==1)
                        {
                          ai_dir[i]=2;
                        }
                      }
                      //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                      ////console.log(conshow);
                      if(ai_dir[i]==1)
                      {
                          strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_left.png"
                         
                      }
                      if(ai_dir[i]==2)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_right.png"
                          
                      }
                      if(ai_dir[i]==3)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_up.png"
                    
                      }
                      if(ai_dir[i]==4)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_down.png"
                          
                      }
                      
                  }
                  if(ai_y[i]>=336)
                  {
                    //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                    //conshow+=",rands:"+(T/100).toString();
                     // //console.log(conshow);
                    
                      while(ai_dir[i]==2)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==2)
                        {
                          ai_dir[i]=1;
                        }
                      }
                      //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                     // //console.log(conshow);
                      if(ai_dir[i]==1)
                      {
                          strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_left.png"
                         
                      }
                      if(ai_dir[i]==2)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_right.png"
                          
                      }
                      if(ai_dir[i]==3)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_up.png"
                    
                      }
                      if(ai_dir[i]==4)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_down.png"
                          
                      }
                      
                  }
  
                  if(ai_dir[i]==1)
                  {
                    var x1=ai_x[i],y1=ai_y[i];
                    var x2=x1,y2=y1+12,x3=x1+12,x4=x1+12,y3=y1,y4=y1+12;
                    y1-=12;
                    y2-=12;
                    y3-=12;
                    y4-=12;
                    var mov=true;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(mov==false)
                    {
                      console.log("turn left"+ii.toString()+' '+jj.toString()+' '+ai_x[i].toString()+' '+ai_y[i].toString());
                      while(ai_dir[i]==1)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==1)
                        {
                          ai_dir[i]=2;
                        }
                      }
                    }
                  }
                  if(ai_dir[i]==2)
                  {
                    var x1=ai_x[i],y1=ai_y[i];
                    var x2=x1,y2=y1+12,x3=x1+12,x4=x1+12,y3=y1,y4=y1+12;
                    y1+=12;
                    y2+=12;
                    y3+=12;
                    y4+=12;
                    var mov=true;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(mov==false)
                    {
                      console.log("turn right"+ii.toString()+' '+jj.toString()+' '+ai_x[i].toString()+' '+ai_y[i].toString());
                      while(ai_dir[i]==2)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==2)
                        {
                          ai_dir[i]=1;
                        }
                      }
                    }
                  }
                  if(ai_dir[i]==3)
                  {
                    var x1=ai_x[i],y1=ai_y[i];
                    var x2=x1,y2=y1+12,x3=x1+12,x4=x1+12,y3=y1,y4=y1+12;
                    x1-=12;
                    x2-=12;
                    x3-=12;
                    x4-=12;
                    var mov=true;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(mov==false)
                    {
                      console.log("turn up"+ii.toString()+' '+jj.toString()+' '+ai_x[i].toString()+' '+ai_y[i].toString());
                      while(ai_dir[i]==3)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==3)
                        {
                          ai_dir[i]=4;
                        }
                      }
                    }
                  }
                  if(ai_dir[i]==4)
                  {
                    var x1=ai_x[i],y1=ai_y[i];
                    var x2=x1,y2=y1+12,x3=x1+12,x4=x1+12,y3=y1,y4=y1+12;
                    x1+=12;
                    x2+=12;
                    x3+=12;
                    x4+=12;
                    var mov=true;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(mov==false)
                    {
                      console.log("turn down"+ii.toString()+' '+jj.toString()+' '+ai_x[i].toString()+' '+ai_y[i].toString());
                      while(ai_dir[i]==4)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==4)
                        {
                          ai_dir[i]=3;
                        }
                      }
                    }
                  }
  
                  //move
                  if(ai_dir[i]==1)
                  {
                      strtemp="ai"+i.toString();
                      var temp1=document.getElementById(strtemp);
                      temp1.src="image//enemy_tank_left.png"
                      ai_y[i]-=12;
                      if(ai_y[i]<=0)
                      {
                        ai_y[i]=0;
                      }
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_x[i].toString()+"px;left:"+ai_y[i].toString()+"px;";
                      temp.style.cssText=st;
                  }
                  if(ai_dir[i]==2)
                  {
                    strtemp="ai"+i.toString();
                      var temp1=document.getElementById(strtemp);
                      temp1.src="image//enemy_tank_right.png"
                      ai_y[i]+=12;
                      if(ai_y[i]>=336)
                      {
                        ai_y[i]=336;
                      }
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_x[i].toString()+"px;left:"+ai_y[i].toString()+"px;";
                      temp.style.cssText=st;
                  }
                  if(ai_dir[i]==3)
                  {
                    strtemp="ai"+i.toString();
                      var temp1=document.getElementById(strtemp);
                      temp1.src="image//enemy_tank_up.png"
                      ai_x[i]-=12;
                      if(ai_x[i]<=0)
                      {
                        ai_x[i]=0;
                      }
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_x[i].toString()+"px;left:"+ai_y[i].toString()+"px;";
                      temp.style.cssText=st;
                  }
                  if(ai_dir[i]==4)
                  {
                    strtemp="ai"+i.toString();
                      var temp1=document.getElementById(strtemp);
                      temp1.src="image//enemy_tank_down.png"
                      ai_x[i]+=12;
                      if(ai_x[i]>=336)
                      {
                        ai_x[i]=336;
                      }
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_x[i].toString()+"px;left:"+ai_y[i].toString()+"px;";
                      temp.style.cssText=st;
                  }
                var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                    conshow+=",rands:"+(T/100).toString();
                      //console.log(conshow);
                }   
                  
              
          
         }
          function repaint()
          {
            if(T==0)
            {
              
                   
              var count=0;
              for(i=1;i<=30;i++)
              {
                for(j=1;j<=30;j++)
                {
                  //0 space 
                  //1 brick
                  //2 home
                  //3 iron
                  //4 water
                  // tree
                  var ii=Math.floor((i+1)/2),jj=Math.floor((j+1)/2);
                  now.push(ditu[(ii-1)*(15)+jj-1]);
                  if(now[(i-1)*(30)+j-1]==2&&now[(i-2)*30+j-1]!=2&&now[(i-1)*30+j-2]!=2)
                  {
                    var txt1="<img id=\""+((i-1)*(30)+j-1).toString()+"\" src=\"image//home2.png\">";
                    $("body").append(txt1); 
                    var x=(i-1)*12;
                    var y=(j-1)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i-1)*(30)+j-1).toString());
                    temp.style.cssText=st;

                    var txt1="<img id=\""+((i)*(30)+j-1).toString()+"\" src=\"\">";
                    $("body").append(txt1); 
                    var x=(i)*12;
                    var y=(j-1)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i)*(30)+j-1).toString());
                    temp.style.cssText=st;

                    var txt1="<img id=\""+((i-1)*(30)+j).toString()+"\" src=\"\">";
                    $("body").append(txt1); 
                    var x=(i-1)*12;
                    var y=(j)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i-1)*(30)+j).toString());
                    temp.style.cssText=st;

                    var txt1="<img id=\""+((i)*(30)+j).toString()+"\" src=\"\">";
                    $("body").append(txt1); 
                    var x=(i)*12;
                    var y=(j)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i)*(30)+j).toString());
                    temp.style.cssText=st;
                  }
                  if(ditu[(ii-1)*(15)+jj-1]==0)
                  {
                    var txt1="<img id=\""+((i-1)*(30)+j-1).toString()+"\" src=\"\">";
                    $("body").append(txt1); 
                    var x=(i-1)*12;
                    var y=(j-1)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i-1)*(30)+j-1).toString());
                    temp.style.cssText=st;
                    //var txt1="<img id=\""+((i-1)*(30)+j-1).toString()+"\" src=\"image//iron.png\">";
                    /*$("body").append(txt1); 
                    var x=(i-1)*12;
                    var y=(j-1)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i-1)*(30)+j-1).toString());
                    temp.style.cssText=st;
                    count++;*/
                  }
                  if(ditu[(ii-1)*(15)+jj-1]==1)
                  {
                    var txt1="<img id=\""+((i-1)*(30)+j-1).toString()+"\" src=\"image//brick.png\">";
                    $("body").append(txt1); 
                    var x=(i-1)*12;
                    var y=(j-1)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i-1)*(30)+j-1).toString());
                    temp.style.cssText=st;
                    count++;
                  }
                  if(ditu[(ii-1)*(15)+jj-1]==3)
                  {
                    var txt1="<img id=\""+((i-1)*(30)+j-1).toString()+"\" src=\"image//iron.png\">";
                    $("body").append(txt1); 
                    var x=(i-1)*12;
                    var y=(j-1)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i-1)*(30)+j-1).toString());
                    temp.style.cssText=st;
                    count++;
                  }
                  if(ditu[(ii-1)*(15)+jj-1]==4)
                  {
                    var txt1="<img id=\""+((i-1)*(30)+j-1).toString()+"\" src=\"image//river1.png\">";
                    $("body").append(txt1); 
                    var x=(i-1)*12;
                    var y=(j-1)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i-1)*(30)+j-1).toString());
                    temp.style.cssText=st;
                    count++;
                  }
                  if(ditu[(ii-1)*(15)+jj-1]==5)
                  {
                    var txt1="<img id=\""+((i-1)*(30)+j-1).toString()+"\" src=\"image//tree.png\">";
                    $("body").append(txt1); 
                    var x=(i-1)*12;
                    var y=(j-1)*12;
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    var temp=document.getElementById(((i-1)*(30)+j-1).toString());
                    temp.style.cssText=st;
                    count++;
                  }
                }
              }
              console.log(now);
            }
            else{
              for(i=1;i<=30;i++)
              {
                for(j=1;j<=30;j++)
                {
                  var temp=document.getElementById(((i-1)*(30)+j-1).toString());
                  if(now[(i-1)*(30)+j-1]==0)
                  {
                    
                    
                      temp.src="";
                      //console.log(1);
                    
                    
                  
                   
                  }
                  
                  ////console.log(i.toString()+','+j.toString()+':'+now[(i-1)*(30)+j-1].toString())
                }
              }
            }
            pre_now=now
          }   
          function bboom2()
          {
            if(is_bullet22==false)
            {
              return;
            }
            for(i=1;i<=num_ai;i++)
            {
              if(ai_survive[i]==false)
              {
                continue;
              }
              var strtemp='bullet'+i.toString();
              var x1=ai_x[i],y1=ai_y[i];
              var x4=x1+24,y4=y1+24;

              if(x1<=bx22+6&&x4>=bx22-6&&y1<=by22+6&&y4>=by22-6)
                  {
                      ////console.log("dead");
                      strtemp="ai"+i.toString();
                      ai_survive[i]=false;
                      var xx=0,yy=0;
                      var temp1=document.getElementById(strtemp);
                          temp1.src=""
              
                          var temp=document.getElementById(strtemp);
                          var st="position: absolute;top:"+xx.toString()+"px;left:"+yy.toString()+"px;";
                          temp.style.cssText=st;
                          var temp1=document.getElementById("bullet22");
                          temp1.src=""
              
                          var temp2=document.getElementById("bullet22");
                      temp2.src="image//boom_static.png";
                      var temp2=document.getElementById("bullet22");
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                      temp2.src="";
                     is_bullet22=false;
                     bx22=0;
                     by22=0;
                     console.log("kill");
                  }
            }
          }
          function bmove2()
          {
              if(is_bullet22)
              {
                  ////console.log(bx);
                  ////console.log(by);
                  ////console.log(bdir);

                  if(bdir22==1)
                  {
                      var mov=true;
                      var ii=Math.floor(bx22/12),jj=Math.floor(by22/12);
                      if(now[ii*30+jj-1]==2||(now[(ii+1)*30+jj-1]==2))
                      {//console.log("brick");
                        now[ii*30+jj-1]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                        socket.send("mb");
                      audio.play();
                          if(now[(ii+1)*30+jj-1]==1)
                          {
                            now[(ii+1)*30+jj-1]=0;
                          }
                        //alert("you have lost");
                        life=0;life2=0;
                        
                      }
                      
                      if(now[ii*30+jj-1]==1||(now[(ii+1)*30+jj-1]==1)||now[ii*30+jj-1]==3||(now[(ii+1)*30+jj-1]==3))
                      {console.log("brick");
                      if(now[ii*30+jj-1]==1)
                        now[ii*30+jj-1]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii+1)*30+jj-1]==1)
                          {
                            now[(ii+1)*30+jj-1]=0;
                          }
                        
                        
                      }
                      else if(now[ii*30+jj-2]==1||(now[(ii+1)*30+jj-2]==1)||now[ii*30+jj-2]==3||(now[(ii+1)*30+jj-2]==3))
                      {console.log("brick");
                      if(now[ii*30+jj-2]==1)
                        now[ii*30+jj-2]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii+1)*30+jj-2]==1)
                          {
                            now[(ii+1)*30+jj-2]=0;
                          }
                        
                        
                      }
                      else{
                        by22-=24;
                        var temp=document.getElementById("bullet22");
                        var st="position: absolute;top:"+bx22.toString()+"px;left:"+by22.toString()+"px;";
                        temp.style.cssText=st;
                        console.log("move");
                      }
                      
                  }
                  if(bdir22==2)
                  {
                    var mov=true;
                      var ii=Math.floor(bx22/12),jj=Math.floor(by22/12);
                      if(now[ii*30+jj+1]==2||(now[(ii+1)*30+jj+1]==2))
                      {console.log("brick");
                        now[ii*30+jj+1]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[ii*30+jj+1]==1||(now[(ii+1)*30+jj+1]==1)||now[ii*30+jj+1]==3||(now[(ii+1)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[ii*30+jj+1]==1)
                        now[ii*30+jj+1]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[ii*30+jj+2]==1||(now[(ii+1)*30+jj+2]==1)||now[ii*30+jj+2]==3||(now[(ii+1)*30+jj+2]==3))
                      {console.log("brick");
                      if( now[ii*30+jj+2]==1)
                        now[ii*30+jj+2]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii+1)*30+jj+2]==1)
                          {
                            now[(ii+1)*30+jj+2]=0;
                          }
                        
                        
                      }
                      else{
                      by22+=24;
                      var temp=document.getElementById("bullet22");
                      var st="position: absolute;top:"+bx22.toString()+"px;left:"+by22.toString()+"px;";
                      temp.style.cssText=st;
                      console.log("move");
                      }
                  }
                  if(bdir22==3)
                  {
                    var mov=true;
                      var ii=Math.floor(bx22/12),jj=Math.floor(by22/12);
                      if(now[(ii-1)*30+jj]==2||(now[(ii-1)*30+jj+1]==2))
                      {console.log("brick");
                        now[(ii-1)*30+jj]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii-1)*30+jj+1]==1)
                          {
                            now[(ii-1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[(ii-1)*30+jj]==1||(now[(ii-1)*30+jj+1]==1)||now[(ii-1)*30+jj]==3||(now[(ii-1)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii-1)*30+jj]==1)
                        now[(ii-1)*30+jj]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii-1)*30+jj+1]==1)
                          {
                            now[(ii-1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[(ii-2)*30+jj]==1||(now[(ii-2)*30+jj+1]==1)||now[(ii-2)*30+jj]==3||(now[(ii-2)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii-2)*30+jj]==1)
                        now[(ii-2)*30+jj]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii-2)*30+jj+1]==1)
                          {
                            now[(ii-2)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else{
                      bx22-=24;
                      var temp=document.getElementById("bullet22");
                      var st="position: absolute;top:"+bx22.toString()+"px;left:"+by22.toString()+"px;";
                      temp.style.cssText=st;
                      console.log("move");
                      }
                  }
                  if(bdir22==4)
                  { 
                      var mov=true;
                      var ii=Math.floor(bx22/12),jj=Math.floor(by22/12);
                      if(now[(ii+1)*30+jj]==2||(now[(ii+1)*30+jj+1]==2))
                      {console.log("brick");
                        now[(ii+1)*30+jj]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                        if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[(ii+1)*30+jj]==1||(now[(ii+1)*30+jj+1]==1)||now[(ii+1)*30+jj]==3||(now[(ii+1)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii+1)*30+jj]==1)
                        now[(ii+1)*30+jj]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                        if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[(ii+2)*30+jj]==1||(now[(ii+2)*30+jj+1]==1)||now[(ii+2)*30+jj]==3||(now[(ii+2)*30+jj+1]==3))
                      {console.log("brick");
                      if( now[(ii+2)*30+jj]==1)
                        now[(ii+2)*30+jj]=0;
                        is_bullet22=false;
                        var temp=document.getElementById("bullet22");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet22");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                          if(now[(ii+2)*30+jj+1]==1)
                          {
                            now[(ii+2)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else{
                      bx22+=24;
                      var temp=document.getElementById("bullet22");
                      var st="position: absolute;top:"+bx22.toString()+"px;left:"+by22.toString()+"px;";
                      temp.style.cssText=st; 
                      console.log("move");
                    }
                  }
                  
                  if(bx22<=0)
                  {
                   
                      is_bullet22=false;
                      var temp=document.getElementById("bullet22");
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById("bullet22");
                      temp.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                     
                  }
                  if(bx22>360)
                  {
                      is_bullet22=false;
                      var temp=document.getElementById("bullet22");
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById("bullet22");
                      temp.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                  }
                  if(by22<=0)
                  {
                      is_bullet22=false;
                      var temp=document.getElementById("bullet22");
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById("bullet22");
                      temp.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                  }
                  if(by22>360)
                  {
                      is_bullet22=false;
                      var temp=document.getElementById("bullet22");
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById("bullet22");
                      temp.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                      socket.send("mb");
                  }
              }
          }
          function change_position1()
          {
            document.getElementById("button1").style.display="none";
            document.getElementById("button2").style.display="none";
            document.getElementById("button3").style.display="none";
            document.getElementById("buttont").style.display="none";
            document.getElementById("passport").style.display="none";
            document.getElementById("room").style.display="none";
            document.getElementById("buttonai").style.display="none";
            max_ai_num=5;
            alert_before=0;
            var audio = new Audio("music//start.wav");
            audio.play();
            var random_audio=Math.floor(Math.random() * (4 - 1));
            if(random_audio==0)
            {
              var audio2=document.getElementById("bg1");
              audio2.play();
            }
            if(random_audio==1)
            {
              var audio2=document.getElementById("bg2");
              audio2.play();
            }
            if(random_audio==2)
            {
              var audio2=document.getElementById("bg3");
              audio2.play();
            }
            life=1;
            setInterval(key_press,100);
            if(life==0)
            {
              location.reload();
              return;
            }
        }
        function change_position2()
          {
            document.getElementById("button1").style.display="none";
            document.getElementById("button2").style.display="none";
            document.getElementById("button3").style.display="none";
            document.getElementById("buttont").style.display="none";
            document.getElementById("buttonai").style.display="none";
            document.getElementById("passport").style.display="none";
            document.getElementById("room").style.display="none";
            max_ai_num=3;
            alert_before=0;
            var audio = new Audio("music//start.wav");
            audio.play();
            life=5;
            var random_audio=Math.floor(Math.random() * (4 - 1));
            if(random_audio==0)
            {
              var audio2=document.getElementById("bg1");
              audio2.play();
            }
            if(random_audio==1)
            {
              var audio2=document.getElementById("bg2");
              audio2.play();
            }
            if(random_audio==2)
            {
              var audio2=document.getElementById("bg3");
              audio2.play();
            }
            setInterval(key_press,100);
            if(life==0)
            {
              location.reload();
              return;
            }
        }
        function change_position3()
          {
            document.getElementById("button1").style.display="none";
            document.getElementById("button2").style.display="none";
            document.getElementById("button3").style.display="none";
            document.getElementById("buttont").style.display="none";
            document.getElementById("buttonai").style.display="none";
            document.getElementById("passport").style.display="none";
            document.getElementById("room").style.display="none";
            max_ai_num=1;
            alert_before=0;
            life=100;
            //var audio1=document.getElementById("start");
            //audio1.play();
            var audio = new Audio("music//start.wav");
            audio.play();
            var random_audio=Math.floor(Math.random() * (4 - 1));
            if(random_audio==0)
            {
              var audio2=document.getElementById("bg1");
              audio2.play();
            }
            if(random_audio==1)
            {
              var audio2=document.getElementById("bg2");
              audio2.play();
            }
            if(random_audio==2)
            {
              var audio2=document.getElementById("bg3");
              audio2.play();
            }
            setInterval(key_press,100);
            if(life==0)
            {
              location.reload();
              return;
            }
        }
        function change_positiont()
          {
            document.getElementById("button1").style.display="none";
            document.getElementById("button2").style.display="none";
            document.getElementById("button3").style.display="none";
            document.getElementById("buttont").style.display="none";
            document.getElementById("buttonai").style.display="none";
            document.getElementById("passport").style.display="none";
            document.getElementById("room").style.display="none";
            max_ai_num=1;
            alert_before=0;
            life2=100;
            life=100;
            var audio1=document.getElementById("start");
            audio1.play();
            var random_audio=Math.floor(Math.random() * (4 - 1));
            if(random_audio==0)
            {
              var audio2=document.getElementById("bg1");
              audio2.play();
              //socket.send("bgm1");
            }
            if(random_audio==1)
            {
              var audio2=document.getElementById("bg2");
              audio2.play();
              //socket.send("bgm2");
            }
            if(random_audio==2)
            {
              var audio2=document.getElementById("bg3");
              audio2.play();
              //socket.send("bgm3");
            }
            
            if (socket.readyState == WebSocket.OPEN)
            {
              //socket.send();
              
              //console.log(document.getElementById('room').value);
              socket.send('p'+document.getElementById('passport').value+'o'+document.getElementById('room').value);
            
              //console.log(document.getElementById('pasport').value);
            }
            
            socket.onmessage = function (event) {
              if(event.data==':j')
              {
                if(random_audio==0)
                {
                  socket.send("bgm1");
                }
            if(random_audio==1)
              {
                socket.send("bgm2");
              }
            if(random_audio==2)
                {
                  socket.send("bgm3");
                }
                setInterval(key_presst,100);
              }
            }
            if(life==0)
            {
              location.reload();
              return;
            }
        }
        function receive()
        {
          socket.onmessage = function (event) {
               if(event.data==':l')
               {
                 p2_leftmove();
               }
               if(event.data==':r')
               {
                 p2_rightmove();
               }
               if(event.data==':u')
               {
                 p2_upmove();
               }
               if(event.data==':d')
               {
                 p2_downmove();
               }
               if(event.data==':g')
               {
                 p2_fire();
               }
            };
        }
        function p2_fire()
        {
          
          if(is_bullet22==true)
                      {
                        //console.log("p2_unfire");
                      }
                      else{
                          //console.log("p2_fire");
                          is_bullet22=true;
                          var temp=document.getElementById("bullet22");
                          var X=x22,Y=y22;
                          if(dir22==1)
                          {
                            X+=6;
                            
                          }
                          if(dir22==2)
                          {
                            X+=6;
                            Y+=12;
                          }
                          if(dir22==3)
                          {
                            Y+=6;
                          }
                          if(dir22==4)
                          {
                            Y+=6;
                            X-=12;
                          }
                          //console.log(x.toString()+' '+y.toString()+' '+X.toString()+' '+Y.toString());
                          var st="position: absolute;top:"+X.toString()+"px;left:"+Y.toString()+"px;";
                          temp.style.cssText=st;
                          bx22=X;
                          by22=Y;
                          bdir22=dir22;
                          var temp=document.getElementById("bullet22");
                          if(dir22==1)
                          {
                              temp.src="image//bullet_left.png";
                          }
                          else if(dir22==2)
                          {
                              temp.src="image//bullet_right.png";
                          }else if(dir22==3)
                          {
                              temp.src="image//bullet_up.png";
                          }else{
                              temp.src="image//bullet_down.png";
                          }
                          
                         
                      }
        }
        function p2_upmove()
        {
          var prex=x22;
             var mov=true;
            // console.log("p2_up");
             var x1=x22-12,y1=y22;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                        if(x22>=12&&mov)
                        {
                          x22-=12;
                          if(x22<0)
                          {
                            x22=0;
                          }
                          if(prex-x22<=12)
                          {
                            var temp1=document.getElementById("twoi");
                            temp1.src="image//player2_tank_1_up.png"
                            //document.getElementById("onep").innerHTML="up";
                            var temp=document.getElementById("twoi");
                            var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                            temp.style.cssText=st;
                            dir22=3;
                           
                            is_move=1;
                          }
                          else{
                            x22+=12;
                          }
                        }
                        if(mov==false)
                {
                  var temp1=document.getElementById("twoi");
                            temp1.src="image//player2_tank_1_up.png"
                            x22=Math.floor(x22/12)*12;
                            if(x22<0)
                            {
                              x22=0;
                            }
                            
                              //document.getElementById("onep").innerHTML="up";
                            var temp=document.getElementById("twoi");
                            var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                            temp.style.cssText=st;
                            dir22=3;
                            is_move=1;
                          
                            
                }
                if(x22<=fdx+48&&x22>=fdx-24&&y22<=fdy+48&&y22>=fdy-24)
              {
                p2_eat_food();
              }
        }
        function p2_downmove()
        {
          var mov=true;
         // console.log("p2_down");
          var prex=x22;
             var x1=x22+12,y1=y22;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    var prex=x22;
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    //console.log(x.toString()+' '+y.toString()+' '+mov.toString());
                        if(x22<=336&&mov)
                        {
                          x22+=12;
                          if(x22<0)
                          {
                            x22=0;
                          }
                          if(x22-prex<=12)
                          {
                            var temp1=document.getElementById("twoi");
                            temp1.src="image//player2_tank_1_down.png"
                            //document.getElementById("onep").innerHTML="down";
                            var temp=document.getElementById("twoi");
                            var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                            temp.style.cssText=st;
                            dir22=4;
                           
                            is_move=1;
                          }
                          else{
                            x22-=12;
                          }
                          
                        }
                  if(mov==false)
                {
                  var temp1=document.getElementById("twoi");
                            temp1.src="image//player2_tank_1_down.png"
                            x22=Math.floor(x22/12)*12;
                            if(x22>=360)
                            {
                              x22=360;
                            }
                            
                              //document.getElementById("onep").innerHTML="down";
                            var temp=document.getElementById("twoi");
                            var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                            temp.style.cssText=st;
                            dir22=4;
                            is_move=1;
                          
                            
                }
                if(x22<=fdx+48&&x22>=fdx-24&&y22<=fdy+48&&y22>=fdy-24)
              {
                p2_eat_food();
              }
        }
        function p2_rightmove()
        {
          var mov=true;
             var x1=x22,y1=y22+12;
             var prey=y22;
             //console.log("p2_right");
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                        if(y22<=336&&mov)
                        {
                          y22+=12;
                          if(y22>360)
                          {
                            y22=360;
                          }
                          if(y22-prey<=12)
                          {
                            var temp1=document.getElementById("twoi");
                            temp1.src="image//player2_tank_1_right.png"
                           // document.getElementById("onep").innerHTML="right";
                            var temp=document.getElementById("twoi");
                            var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                            temp.style.cssText=st;
                            dir22=2;
                        
                            is_move=1;
                          }
                          else{
                            y22-=12;
                          }
                        }
                        if(mov==false)
                {
                  var temp1=document.getElementById("twoi");
                            temp1.src="image//player2_tank_1_right.png"
                            y22=Math.floor(y22/12)*12+1;
                            if(y22>360)
                            {
                              y22=360;
                            }
                            
                              //document.getElementById("onep").innerHTML="right";
                            var temp=document.getElementById("twoi");
                            var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                            temp.style.cssText=st;
                            dir22=2;
                            is_move=1;
                          
                            
                }
                if(x22<=fdx+48&&x22>=fdx-24&&y22<=fdy+48&&y22>=fdy-24)
              {
                p2_eat_food();
              }
        }
        function p2_leftmove()
        {
          var mov=true;
             var x1=x22,y1=y22-12;
             var prey=y22;
             //console.log("p2_left");
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                if(y22>=12&&mov)
                          {
                            
                            var temp1=document.getElementById("twoi");
                            temp1.src="image//player2_tank_1_left.png"
                            y22-=12;
                            if(y22<0)
                            {
                              y22=0;
                            }
                            if(prey-y22<=12)
                            {
                            //  document.getElementById("onep").innerHTML="left";
                            var temp=document.getElementById("twoi");
                            var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                            temp.style.cssText=st;
                            dir22=1;
                           
                            }
                            else{
                              y22+=12;
                            }
                          }
                if(mov==false)
                {
                  var temp1=document.getElementById("twoi");
                            temp1.src="image//player2_tank_1_left.png"
                            y22=Math.floor(y22/12)*12;
                            if(y22<0)
                            {
                              y22=0;
                            }
                            
                              //document.getElementById("onep").innerHTML="left";
                            var temp=document.getElementById("twoi");
                            var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                            temp.style.cssText=st;
                            dir22=1;
                          
                            
                }
                if(x22<=fdx+48&&x22>=fdx-24&&y22<=fdy+48&&y22>=fdy-24)
              {
                p2_eat_food();
              }
           }
        function send_data()
        {
          
          socket.send('1'+now.toString());
          //console.log('1');
          var data_to_send="3";
          for(i=1;i<=num_ai;i++)
          {
            if(ai_able_to_fire[i]==false)
              data_to_send+=ai_bx[i].toString()+','+ai_by[i].toString()+','+ai_bdir[i].toString()+',1,';
          }
          socket.send(data_to_send);
         // console.log('2');
          data_to_send='2';
          for(i=1;i<=num_ai;i++)
          {
              data_to_send+=ai_x[i].toString()+','+ai_y[i].toString()+','+ai_dir[i].toString()+',1,';
          }
          socket.send(data_to_send);

         // console.log('3');
          socket.send('4'+x.toString()+','+y.toString()+','+dir.toString());
          //console.log('4');
          if(is_bullet)
          {
            socket.send('5'+bx.toString()+','+by.toString()+','+bdir.toString());
          }
          
          else{
            socket.send('5no');
          }
          //console.log('5');
          socket.send('6'+x22.toString()+','+y22.toString()+','+dir22.toString()+','+life2.toString());
         // console.log('6');
          if(is_bullet22)
          {
             socket.send('7'+bx22.toString()+','+by22.toString()+','+bdir22.toString());
          }
         else{
          socket.send('7no');
         }
         if(foodnum==0)
         {
          socket.send('8no');
         }
         else
         {
           socket.send('8'+foodnum.toString()+','+fdx.toString()+','+fdy.toString());
         }
         
         // console.log('7');
          socket.send('f'+(T/100).toString());
          //console.log('f');
        }
        function key_presst()
          {
                  //screen_update();
                  repaint();
                  if(T==0)
                  {
                    var temp1=document.getElementById("onei");
                    temp1.src="image//player1_tank_1_up.png"
                                  //document.getElementById("onep").innerHTML="up";
                    var temp=document.getElementById("onei");
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    temp.style.cssText=st;
                    dir=3;
                    var temp1=document.getElementById("twoi");
                    temp1.src="image//player2_tank_1_up.png"
                                  //document.getElementById("onep").innerHTML="up";
                    var temp=document.getElementById("twoi");
                    var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                    temp.style.cssText=st;
                    dir22=3;
                  }
                  bmove();
                  if(time_freeze_time+5100>=T&&time_freeze_time!=0)
                  {

                  }
                  else{
                    ai_movet();
                  ai_fire();
                  ai_bmove();
                  ai_battle_boomt();
                  }
                  
                  document.getElementById("life").innerHTML="life:"+life.toString();
                  if(life==0&&life2==0)
                  {
                    if(alert_before==0)
                    {
                      socket.send("alert_lost");
                      alert("you have lost!");
                      alert_before=1;
                      
                    }
                    else{
                      socket.send("refresh");
                      location.reload();
                    }
                    document.getElementById("lost").innerHTML="You have lost!!!";
                    
                    //console.log("lost");
                    return;
                  }
                  b_boom();
                  creat_food();
                  if(last==0)
                  {
                    var su=0;
                    for(i=1;i<=num_ai;i++)
                    {
                        if(ai_survive[i])
                        {
                          su++;
                        }
                    }
                    if(su==0)
                    {
                      if(alert_before==0)
                      {
                        socket.send("alert_win");
                        alert("you win!");
                        alert_before=1;
                      }
                      else{
                        socket.send("refresh");
                        location.reload();
                      }
                      document.getElementById("lost").innerHTML="You win!!!";
                      
                      return;
                      }
                  }
                  send_data();
                  receive();
                  bmove2();
                  bboom2();
                  T+=100;
                  ////console.log("move");
                  is_move=0;
                  var prex=x,prey=y;
                  tempkeycode=0;
                 document.addEventListener('keydown',function(e){
                  ////console.log(count.toString());
                  if(e.keyCode == 37){
                   left_move();
                    }
                  else if(e.keyCode == 39){
                    right_move();
                          
                      
                  }else if(e.keyCode == 38){
                    up_move();
                      
                  }else if(e.keyCode == 40){
                    down_move();
                      
                  }else if(e.keyCode == 70){
                    my_fire();
              
                  }
                
  
                 })
              }
          function ai_battle_boom()
          {
              for(i=1;i<=num_ai;i++)
              {
                var strtemp='aib'+i.toString();
                if(ai_able_to_fire[i])
                {
                  continue;
                }
                  if(ai_bx[i]-x<=12&&ai_bx[i]-x>=-12&&ai_by[i]-y<=12&&ai_by[i]-y>=-12)
                  {
                      life--;
                      if(life==0)
                      {
                          return;
                      }
                      ////console.log(life);
                      var  xx=300,yy=100;
                      var temp1=document.getElementById("onei");
                          temp1.src="image//player1_tank_1_up.png"
                          //document.getElementById("onep").innerHTML="up";
                          var temp=document.getElementById("onei");
                          var st="position: absolute;top:"+xx.toString()+"px;left:"+yy.toString()+"px;";
                          temp.style.cssText=st;
                          dir=3
                          x=300;
                          y=100;
                          ai_able_to_fire[i]=true;
                          ai_by[i]=0;
                    ai_bx[i]=0;
                      var temp=document.getElementById(strtemp);
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById(strtemp);
                      temp.src="";
                  }
              }
          }
          function ai_fire()
          {
              for(i=1;i<=num_ai;i+=1)
              {
                if(ai_survive[i]==false)
                {
                  continue;
                }
                if(ai_able_to_fire[i])
                {
                  //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                   // conshow+=",ai_fire";
                      ////console.log(conshow);
                    var strtemp="aib"+i.toString();
                    var temp=document.getElementById(strtemp);
                    ai_able_to_fire[i]=false;
                        var X=ai_x[i],Y=ai_y[i];
                          if(ai_dir[i]==1)
                          {
                            X+=6;
                          }
                          if(ai_dir[i]==2)
                          {
                            X+=6;
                            Y+=12;
                          }
                          if(ai_dir[i]==3)
                          {
                            Y+=6;
                          }
                          if(ai_dir[i]==4)
                          {
                            Y+=6;
                            X-=12;
                          }
                          var st="position: absolute;top:"+X.toString()+"px;left:"+Y.toString()+"px;";
                          temp.style.cssText=st;
                          ai_bx[i]=X;
                          ai_by[i]=Y;
                          ai_bdir[i]=ai_dir[i];
                          var temp=document.getElementById(strtemp);
                          if(ai_dir[i]==1)
                          {
                              temp.src="image//bullet_left.png";
                          }
                          else if(ai_dir[i]==2)
                          {
                              temp.src="image//bullet_right.png";
                          }else if(ai_dir[i]==3)
                          {
                              temp.src="image//bullet_up.png";
                          }else{
                              temp.src="image//bullet_down.png";
                          }
                    
                }
              }
          }
          function ai_move()
          {
              if(T%2000==0&&last>0)
              {
                if(num_ai<max_ai_num)
                {
                  num_ai+=1;
                }
                var creat_num=0;
                for(j=1;j<=num_ai;j++)
                {
                  if(ai_survive[j]==false)
                  {
                    creat_num=j;
                    ai_survive[j]=true;
                  }
                }
                if(creat_num!=0) 
                {
                  last--;
                  strtemp="ai"+creat_num.toString();
                  var temp1=document.getElementById(strtemp);
                  temp1.src="image//enemy_tank_down.png";
                  var temp=document.getElementById(strtemp);
                  var x=12;
                  var y=12;
                  if(max_ai_num==5)
                  {
                    var randomx=Math.floor((T/100))%3 ;
                    if(randomx==2)
                    {
                      x=12;
                      y=150;
                    }
                    if(randomx==1)
                    {
                      x=12;
                      y=300;
                    }
                  }
                  var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                  temp.style.cssText=st;
                  ai_dir[creat_num]=4;
                  ai_x[creat_num]=x;
                  ai_y[creat_num]=y;
                }
                  
              }
              T+=100;
              for(i=1;i<=num_ai;i++)
              {
                if(ai_survive[i]==false)
                  {
                    continue;
                  }
                // var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                   //conshow+=",rands:"+(T/100).toString();
                   // //console.log(conshow);
                  
                  if(ai_x[i]-x<=12&&ai_x[i]-x>=-12&&ai_y[i]-y<=12&&ai_y[i]-y>=-12)//防碰撞
                  {
                      var tempdir=ai_dir[i];
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                         if(ai_dir[i]==tempdir)
                         {
                           ai_dir[i]=(tempdir+1)%4+1;
                         }
                         if(ai_dir[i]==1)
                          {
                              strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_left.png"
                            
                          }
                          if(ai_dir[i]==2)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_right.png"
                              ai_y[i]+=12;
                              
                          }
                          if(ai_dir[i]==3)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_up.png"
                        
                          }
                          if(ai_dir[i]==4)
                          {
                            strtemp="ai"+i.toString();
                              var temp1=document.getElementById(strtemp);
                              temp1.src="image//enemy_tank_down.png"
                              
                          }
                  }
                  for(j=1;j<i;j++)//防碰撞
                  {
                    var xx=ai_x[j],yy=ai_y[j],ddir=ai_dir[j];
                    if(ai_x[i]-xx<=12&&ai_x[i]-xx>=-12&&ai_y[i]-yy<=12&&ai_y[i]-yy>=-12)
                    {
                        var tempdir=ai_dir[i];
                          ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                          if(ai_dir[i]==tempdir)
                          {
                            ai_dir[i]=ddir;
                          }
                          if(ai_dir[i]==1)
                            {
                                strtemp="ai"+i.toString();
                                var temp1=document.getElementById(strtemp);
                                temp1.src="image//enemy_tank_left.png"
                              
                            }
                            if(ai_dir[i]==2)
                            {
                              strtemp="ai"+i.toString();
                                var temp1=document.getElementById(strtemp);
                                temp1.src="image//enemy_tank_right.png"
                                
                            }
                            if(ai_dir[i]==3)
                            {
                              strtemp="ai"+i.toString();
                                var temp1=document.getElementById(strtemp);
                                temp1.src="image//enemy_tank_up.png"
                          
                            }
                            if(ai_dir[i]==4)
                            {
                              strtemp="ai"+i.toString();
                                var temp1=document.getElementById(strtemp);
                                temp1.src="image//enemy_tank_down.png"
                                
                            }
                    }
                  }
                  if(ai_x[i]<=0)
                  {
                    /*var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                    conshow+=",rands:"+(T/100).toString();
                      //console.log(conshow);*/
                      while(ai_dir[i]==3)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==3)
                        {
                          ai_dir[i]=4;
                        }
                      }
                      //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                      ////console.log(conshow);
                      if(ai_dir[i]==1)
                      {
                          strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_left.png"
                         
                      }
                      if(ai_dir[i]==2)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_right.png"
                          
                      }
                      if(ai_dir[i]==3)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_up.png"
                    
                      }
                      if(ai_dir[i]==4)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_down.png"
                          
                      }
                      
                  }
                  if(ai_x[i]>=336)
                  {
                    //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                   // conshow+=",rands:"+(T/100).toString();
                    //  //console.log(conshow);
                    while(ai_dir[i]==4)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==4)
                        {
                          ai_dir[i]=3;
                        }
                      }
                      //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                      ////console.log(conshow);
                      if(ai_dir[i]==1)
                      {
                          strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_left.png"
                         
                      }
                      if(ai_dir[i]==2)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_right.png"
                          
                      }
                      if(ai_dir[i]==3)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_up.png"
                    
                      }
                      if(ai_dir[i]==4)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_down.png"
                          
                      }
                      
                  }
                  if(ai_y[i]<=0)
                  {
                    //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                    //conshow+=",rands:"+(T/100).toString();
                     // //console.log(conshow);
                     while(ai_dir[i]==1)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==1)
                        {
                          ai_dir[i]=2;
                        }
                      }
                      //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                      ////console.log(conshow);
                      if(ai_dir[i]==1)
                      {
                          strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_left.png"
                         
                      }
                      if(ai_dir[i]==2)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_right.png"
                          
                      }
                      if(ai_dir[i]==3)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_up.png"
                    
                      }
                      if(ai_dir[i]==4)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_down.png"
                          
                      }
                      
                  }
                  if(ai_y[i]>=336)
                  {
                    //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                    //conshow+=",rands:"+(T/100).toString();
                     // //console.log(conshow);
                    
                      while(ai_dir[i]==2)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==2)
                        {
                          ai_dir[i]=1;
                        }
                      }
                      //var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                     // //console.log(conshow);
                      if(ai_dir[i]==1)
                      {
                          strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_left.png"
                         
                      }
                      if(ai_dir[i]==2)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_right.png"
                          
                      }
                      if(ai_dir[i]==3)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_up.png"
                    
                      }
                      if(ai_dir[i]==4)
                      {
                        strtemp="ai"+i.toString();
                          var temp1=document.getElementById(strtemp);
                          temp1.src="image//enemy_tank_down.png"
                          
                      }
                      
                  }
  
                  if(ai_dir[i]==1)
                  {
                    var x1=ai_x[i],y1=ai_y[i];
                    var x2=x1,y2=y1+12,x3=x1+12,x4=x1+12,y3=y1,y4=y1+12;
                    y1-=12;
                    y2-=12;
                    y3-=12;
                    y4-=12;
                    var mov=true;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(mov==false)
                    {
                      console.log("turn left"+ii.toString()+' '+jj.toString()+' '+ai_x[i].toString()+' '+ai_y[i].toString());
                      while(ai_dir[i]==1)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==1)
                        {
                          ai_dir[i]=2;
                        }
                      }
                    }
                  }
                  if(ai_dir[i]==2)
                  {
                    var x1=ai_x[i],y1=ai_y[i];
                    var x2=x1,y2=y1+12,x3=x1+12,x4=x1+12,y3=y1,y4=y1+12;
                    y1+=12;
                    y2+=12;
                    y3+=12;
                    y4+=12;
                    var mov=true;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(mov==false)
                    {
                      console.log("turn right"+ii.toString()+' '+jj.toString()+' '+ai_x[i].toString()+' '+ai_y[i].toString());
                      while(ai_dir[i]==2)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==2)
                        {
                          ai_dir[i]=1;
                        }
                      }
                    }
                  }
                  if(ai_dir[i]==3)
                  {
                    var x1=ai_x[i],y1=ai_y[i];
                    var x2=x1,y2=y1+12,x3=x1+12,x4=x1+12,y3=y1,y4=y1+12;
                    x1-=12;
                    x2-=12;
                    x3-=12;
                    x4-=12;
                    var mov=true;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(mov==false)
                    {
                      console.log("turn up"+ii.toString()+' '+jj.toString()+' '+ai_x[i].toString()+' '+ai_y[i].toString());
                      while(ai_dir[i]==3)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==3)
                        {
                          ai_dir[i]=4;
                        }
                      }
                    }
                  }
                  if(ai_dir[i]==4)
                  {
                    var x1=ai_x[i],y1=ai_y[i];
                    var x2=x1,y2=y1+12,x3=x1+12,x4=x1+12,y3=y1,y4=y1+12;
                    x1+=12;
                    x2+=12;
                    x3+=12;
                    x4+=12;
                    var mov=true;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(mov==false)
                    {
                      console.log("turn down"+ii.toString()+' '+jj.toString()+' '+ai_x[i].toString()+' '+ai_y[i].toString());
                      while(ai_dir[i]==4)
                      {
                        ai_dir[i]=Math.floor(Math.random() * (5 - 1)) + 1;
                        if(ai_dir[i]==4)
                        {
                          ai_dir[i]=3;
                        }
                      }
                    }
                  }
  
                  //move
                  if(ai_dir[i]==1)
                  {
                      strtemp="ai"+i.toString();
                      var temp1=document.getElementById(strtemp);
                      temp1.src="image//enemy_tank_left.png"
                      ai_y[i]-=12;
                      if(ai_y[i]<=0)
                      {
                        ai_y[i]=0;
                      }
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_x[i].toString()+"px;left:"+ai_y[i].toString()+"px;";
                      temp.style.cssText=st;
                  }
                  if(ai_dir[i]==2)
                  {
                    strtemp="ai"+i.toString();
                      var temp1=document.getElementById(strtemp);
                      temp1.src="image//enemy_tank_right.png"
                      ai_y[i]+=12;
                      if(ai_y[i]>=336)
                      {
                        ai_y[i]=336;
                      }
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_x[i].toString()+"px;left:"+ai_y[i].toString()+"px;";
                      temp.style.cssText=st;
                  }
                  if(ai_dir[i]==3)
                  {
                    strtemp="ai"+i.toString();
                      var temp1=document.getElementById(strtemp);
                      temp1.src="image//enemy_tank_up.png"
                      ai_x[i]-=12;
                      if(ai_x[i]<=0)
                      {
                        ai_x[i]=0;
                      }
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_x[i].toString()+"px;left:"+ai_y[i].toString()+"px;";
                      temp.style.cssText=st;
                  }
                  if(ai_dir[i]==4)
                  {
                    strtemp="ai"+i.toString();
                      var temp1=document.getElementById(strtemp);
                      temp1.src="image//enemy_tank_down.png"
                      ai_x[i]+=12;
                      if(ai_x[i]>=336)
                      {
                        ai_x[i]=336;
                      }
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_x[i].toString()+"px;left:"+ai_y[i].toString()+"px;";
                      temp.style.cssText=st;
                  }
                var conshow=i.toString()+':'+ai_dir[i].toString()+',x:'+ai_x[i].toString()+",y:"+ai_y[i].toString();
                    conshow+=",rands:"+(T/100).toString();
                      //console.log(conshow);
                }   
                  
              
          }
          function bmove()
          {
              if(is_bullet)
              {
                  ////console.log(bx);
                  ////console.log(by);
                  ////console.log(bdir);

                  if(bdir==1)
                  {
                      var mov=true;
                      var ii=Math.floor(bx/12),jj=Math.floor(by/12);
                      if(now[ii*30+jj-1]==2||(now[(ii+1)*30+jj-1]==2))
                      {//console.log("brick");
                        now[ii*30+jj-1]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii+1)*30+jj-1]==1)
                          {
                            now[(ii+1)*30+jj-1]=0;
                          }
                        //alert("you have lost");
                        life=0;life2=0;
                        
                        
                      }
                      
                      if(now[ii*30+jj-1]==1||(now[(ii+1)*30+jj-1]==1)||now[ii*30+jj-1]==3||(now[(ii+1)*30+jj-1]==3))
                      {console.log("brick");
                      if(now[ii*30+jj-1]==1)
                        now[ii*30+jj-1]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii+1)*30+jj-1]==1)
                          {
                            now[(ii+1)*30+jj-1]=0;
                          }
                        
                        
                      }
                      else if(now[ii*30+jj-2]==1||(now[(ii+1)*30+jj-2]==1)||now[ii*30+jj-2]==3||(now[(ii+1)*30+jj-2]==3))
                      {console.log("brick");
                      if(now[ii*30+jj-2]==1)
                        now[ii*30+jj-2]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii+1)*30+jj-2]==1)
                          {
                            now[(ii+1)*30+jj-2]=0;
                          }
                        
                        
                      }
                      else{
                        by-=24;
                        var temp=document.getElementById("bullet");
                        var st="position: absolute;top:"+bx.toString()+"px;left:"+by.toString()+"px;";
                        temp.style.cssText=st;
                        console.log("move");
                      }
                      
                  }
                  if(bdir==2)
                  {
                    var mov=true;
                      var ii=Math.floor(bx/12),jj=Math.floor(by/12);
                      if(now[ii*30+jj+1]==2||(now[(ii+1)*30+jj+1]==2))
                      {console.log("brick");
                        now[ii*30+jj+1]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[ii*30+jj+1]==1||(now[(ii+1)*30+jj+1]==1)||now[ii*30+jj+1]==3||(now[(ii+1)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[ii*30+jj+1]==1)
                        now[ii*30+jj+1]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[ii*30+jj+2]==1||(now[(ii+1)*30+jj+2]==1)||now[ii*30+jj+2]==3||(now[(ii+1)*30+jj+2]==3))
                      {console.log("brick");
                      if( now[ii*30+jj+2]==1)
                        now[ii*30+jj+2]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii+1)*30+jj+2]==1)
                          {
                            now[(ii+1)*30+jj+2]=0;
                          }
                        
                        
                      }
                      else{
                      by+=24;
                      var temp=document.getElementById("bullet");
                      var st="position: absolute;top:"+bx.toString()+"px;left:"+by.toString()+"px;";
                      temp.style.cssText=st;
                      console.log("move");
                      }
                  }
                  if(bdir==3)
                  {
                    var mov=true;
                      var ii=Math.floor(bx/12),jj=Math.floor(by/12);
                      if(now[(ii-1)*30+jj]==2||(now[(ii-1)*30+jj+1]==2))
                      {console.log("brick");
                        now[(ii-1)*30+jj]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii-1)*30+jj+1]==1)
                          {
                            now[(ii-1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[(ii-1)*30+jj]==1||(now[(ii-1)*30+jj+1]==1)||now[(ii-1)*30+jj]==3||(now[(ii-1)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii-1)*30+jj]==1)
                        now[(ii-1)*30+jj]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii-1)*30+jj+1]==1)
                          {
                            now[(ii-1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[(ii-2)*30+jj]==1||(now[(ii-2)*30+jj+1]==1)||now[(ii-2)*30+jj]==3||(now[(ii-2)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii-2)*30+jj]==1)
                        now[(ii-2)*30+jj]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii-2)*30+jj+1]==1)
                          {
                            now[(ii-2)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else{
                      bx-=24;
                      var temp=document.getElementById("bullet");
                      var st="position: absolute;top:"+bx.toString()+"px;left:"+by.toString()+"px;";
                      temp.style.cssText=st;
                      console.log("move");
                      }
                  }
                  if(bdir==4)
                  { 
                      var mov=true;
                      var ii=Math.floor(bx/12),jj=Math.floor(by/12);
                      if(now[(ii+1)*30+jj]==2||(now[(ii+1)*30+jj+1]==2))
                      {console.log("brick");
                        now[(ii+1)*30+jj]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                        if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[(ii+1)*30+jj]==1||(now[(ii+1)*30+jj+1]==1)||now[(ii+1)*30+jj]==3||(now[(ii+1)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii+1)*30+jj]==1)
                        now[(ii+1)*30+jj]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                        if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[(ii+2)*30+jj]==1||(now[(ii+2)*30+jj+1]==1)||now[(ii+2)*30+jj]==3||(now[(ii+2)*30+jj+1]==3))
                      {console.log("brick");
                      if( now[(ii+2)*30+jj]==1)
                        now[(ii+2)*30+jj]=0;
                        is_bullet=false;
                        var temp=document.getElementById("bullet");
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById("bullet");
                        temp.src="";
                        var audio = new Audio("music//bang.wav");
                      audio.play();
                          if(now[(ii+2)*30+jj+1]==1)
                          {
                            now[(ii+2)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else{
                      bx+=24;
                      var temp=document.getElementById("bullet");
                      var st="position: absolute;top:"+bx.toString()+"px;left:"+by.toString()+"px;";
                      temp.style.cssText=st; 
                      console.log("move");
                    }
                  }
                  
                  if(bx<=0)
                  {
                   
                      is_bullet=false;
                      var temp=document.getElementById("bullet");
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById("bullet");
                      temp.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                     
                  }
                  if(bx>360)
                  {
                      is_bullet=false;
                      var temp=document.getElementById("bullet");
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById("bullet");
                      temp.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                  }
                  if(by<=0)
                  {
                      is_bullet=false;
                      var temp=document.getElementById("bullet");
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById("bullet");
                      temp.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                  }
                  if(by>360)
                  {
                      is_bullet=false;
                      var temp=document.getElementById("bullet");
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById("bullet");
                      temp.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                  }
              }
          }
          function b_boom()
          {
            if(is_bullet==false)
            {
              return;
            }
            for(i=1;i<=num_ai;i++)
            {
              if(ai_survive[i]==false)
              {
                continue;
              }
              var strtemp='bullet'+i.toString();
              var x1=ai_x[i],y1=ai_y[i];
              var x4=x1+24,y4=y1+24;

              if(x1<=bx+6&&x4>=bx-6&&y1<=by+6&&y4>=by-6)
                  {
                      ////console.log("dead");
                      strtemp="ai"+i.toString();
                      ai_survive[i]=false;
                      var xx=0,yy=0;
                      var temp1=document.getElementById(strtemp);
                          temp1.src=""
              
                          var temp=document.getElementById(strtemp);
                          var st="position: absolute;top:"+xx.toString()+"px;left:"+yy.toString()+"px;";
                          temp.style.cssText=st;
                          var temp1=document.getElementById("bullet");
                          temp1.src=""
              
                          var temp2=document.getElementById("bullet");
                      temp2.src="image//boom_static.png";
                      var temp2=document.getElementById("bullet");
                      temp2.src="";
                      var audio = new Audio("music//bang.wav");
                      audio.play();
                     is_bullet=false;
                     bx=0;
                     by=0;
                     console.log("kill");
                  }
            }
                  
           
          }
          function ai_bmove()
          {
              for(i=1;i<=num_ai;i++)
              {
                
                
                strtemp="aib"+i.toString();
                if(ai_bdir[i]==1)
                  {
                    var mov=true;
                      var ii=Math.floor(ai_bx[i]/12),jj=Math.floor(ai_by[i]/12);
                      if(now[ii*30+jj-1]==2||(now[(ii+1)*30+jj-1]==2))
                      {//console.log("brick");
                        now[ii*30+jj-1]=0;
                        ai_able_to_fire[i]=true;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii+1)*30+jj-1]==1)
                          {
                            now[(ii+1)*30+jj-1]=0;
                          }
                        //alert("you have lost");
                        life=0;life2=0;
                        
                        
                      }
                      
                      if(now[ii*30+jj-1]==1||(now[(ii+1)*30+jj-1]==1)||now[ii*30+jj-1]==3||(now[(ii+1)*30+jj-1]==3))
                      {console.log("brick");
                      if(now[ii*30+jj-1]==1)
                        now[ii*30+jj-1]=0;
                        ai_able_to_fire[i]=true;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii+1)*30+jj-1]==1)
                          {
                            now[(ii+1)*30+jj-1]=0;
                          }
                        
                        
                      }
                      else if(now[ii*30+jj-2]==1||(now[(ii+1)*30+jj-2]==1)||now[ii*30+jj-2]==3||(now[(ii+1)*30+jj-2]==3))
                      {console.log("brick");
                      if(now[ii*30+jj-2]==1)
                        now[ii*30+jj-2]=0;
                        ai_able_to_fire[i]=true;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii+1)*30+jj-2]==1)
                          {
                            now[(ii+1)*30+jj-2]=0;
                          }
                        
                        
                      }
                      else{
                      ai_by[i]-=24;
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_bx[i].toString()+"px;left:"+ai_by[i].toString()+"px;";
                      temp.style.cssText=st;
                      }
                      
                  }
                  if(ai_bdir[i]==2)
                  {
                    var ii=Math.floor(ai_bx[i]/12),jj=Math.floor(ai_by[i]/12);
                      if(now[ii*30+jj+1]==2||(now[(ii+1)*30+jj+1]==2))
                      {console.log("brick");
                        now[ii*30+jj+1]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[ii*30+jj+1]==1||(now[(ii+1)*30+jj+1]==1)||now[ii*30+jj+1]==3||(now[(ii+1)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[ii*30+jj+1]==1)
                        now[ii*30+jj+1]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[ii*30+jj+2]==1||(now[(ii+1)*30+jj+2]==1)||now[ii*30+jj+2]==3||(now[(ii+1)*30+jj+2]==3))
                      {console.log("brick");
                      if(now[ii*30+jj+2]==1)
                        now[ii*30+jj+2]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii+1)*30+jj+2]==1)
                          {
                            now[(ii+1)*30+jj+2]=0;
                          }
                        
                        
                      }
                      else{
                    ai_by[i]+=24;
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_bx[i].toString()+"px;left:"+ai_by[i].toString()+"px;";
                      temp.style.cssText=st;
                      
                      }
                  }
                  if(ai_bdir[i]==3)
                  {
                    var ii=Math.floor(ai_bx[i]/12),jj=Math.floor(ai_by[i]/12);
                      if(now[(ii-1)*30+jj]==2||(by%12==0&&now[(ii-1)*30+jj+1]==2))
                      {console.log("brick");
                        now[(ii-1)*30+jj]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii-1)*30+jj+1]==1)
                          {
                            now[(ii-1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[(ii-1)*30+jj]==1||(by%12==0&&now[(ii-1)*30+jj+1]==1)||now[(ii-1)*30+jj]==3||(by%12==0&&now[(ii-1)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii-1)*30+jj]==1)
                        now[(ii-1)*30+jj]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii-1)*30+jj+1]==1)
                          {
                            now[(ii-1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[(ii-2)*30+jj]==1||(by%12==0&&now[(ii-2)*30+jj+1]==1)||now[(ii-2)*30+jj]==3||(by%12==0&&now[(ii-2)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii-2)*30+jj]==1)
                        now[(ii-2)*30+jj]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii-2)*30+jj+1]==1)
                          {
                            now[(ii-2)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else{
                    ai_bx[i]-=24;
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_bx[i].toString()+"px;left:"+ai_by[i].toString()+"px;";
                      temp.style.cssText=st;
                      
                      }
                  }
                  if(ai_bdir[i]==4)
                  {
                    var ii=Math.floor(ai_bx[i]/12),jj=Math.floor(ai_by[i]/12);
                      if(now[(ii+1)*30+jj]==2||(by%12==0&&now[(ii+1)*30+jj+1]==2))
                      {console.log("brick");
                        now[(ii+1)*30+jj]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        life=0;life2=0;
                        
                      }
                      
                      if(now[(ii+1)*30+jj]==1||(by%12==0&&now[(ii+1)*30+jj+1]==1)||now[(ii+1)*30+jj]==3||(by%12==0&&now[(ii+1)*30+jj+1]==3))
                      {console.log("brick");
                      if( now[(ii+1)*30+jj]==1)
                        now[(ii+1)*30+jj]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        if(now[(ii+1)*30+jj+1]==1)
                          {
                            now[(ii+1)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else if(now[(ii+2)*30+jj]==1||(by%12==0&&now[(ii+2)*30+jj+1]==1)||now[(ii+2)*30+jj]==3||(by%12==0&&now[(ii+2)*30+jj+1]==3))
                      {console.log("brick");
                      if(now[(ii+2)*30+jj]==1)
                        now[(ii+2)*30+jj]=0;
                        ai_able_to_fire[i]=false;
                        var temp=document.getElementById(strtemp);
                        temp.src="image//boom_static.png";
                        var temp=document.getElementById(strtemp);
                        temp.src="";
                        
                          if(now[(ii+2)*30+jj+1]==1)
                          {
                            now[(ii+2)*30+jj+1]=0;
                          }
                        
                        
                      }
                      else{
                    ai_bx[i]+=24;
                      var temp=document.getElementById(strtemp);
                      var st="position: absolute;top:"+ai_bx[i].toString()+"px;left:"+ai_by[i].toString()+"px;";
                      temp.style.cssText=st;
                      }
                  }
                  
                  if(ai_bx[i]<=0)
                  {
                    ////console.log(i.toString()+':end');
                    ai_able_to_fire[i]=true;
                    ai_by[i]=0;
                    ai_bx[i]=0;
                      var temp=document.getElementById(strtemp);
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById(strtemp);
                      temp.src="";
                  }
                  if(ai_bx[i]>=360)
                  {
                    ////console.log(i.toString()+':end');
                    ai_able_to_fire[i]=true;
                    ai_by[i]=0;
                    ai_bx[i]=0;
                      var temp=document.getElementById(strtemp);
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById(strtemp);
                      temp.src="";
                  }
                  if(ai_by[i]<=0)
                  {
                    ////console.log(i.toString()+':end');
                      ai_able_to_fire[i]=true;
                      ai_by[i]=0;
                    ai_bx[i]=0;
                      var temp=document.getElementById(strtemp);
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById(strtemp);
                      temp.src="";
                  }
                  if(ai_by[i]>=360)
                  {
                   // //console.log(i.toString()+':end');
                    ai_able_to_fire[i]=true;
                    ai_by[i]=0;
                    ai_bx[i]=0;
                      var temp=document.getElementById(strtemp);
                      temp.src="image//boom_static.png";
                      var temp=document.getElementById(strtemp);
                      temp.src="";
                  }
              }
          }
          function creat_food()
          {
            var countttt=0;
            for(i=1;i<=max_ai_num;i++)
            {
              if(ai_survive[i])
              {
                countttt++;
              }
            }
            if(last+countttt!=eatnum)
            if(last+countttt==7||last+countttt==5||last+countttt==2)
            {
              var randf=Math.floor(Math.random() * (3 - 1))+1;
             // randf=2;
              if(randf==1)
              {
                document.getElementById("food").src="image//food_tank.png";
                foodnum=1;
              }
              if(randf==2)
              {
                document.getElementById("food").src="image//food_clock.png";
                foodnum=2;
              }
              if(randf==3)
              {
                document.getElementById("food").src="image//food_boom.png";
                foodnum=3;
              }
              eatnum=last+countttt;
              var temp=document.getElementById("food");
              fdx=Math.floor(Math.random() * (250 - 100))+1;
              fdy=Math.floor(Math.random() * (250 - 100))+1;
              //fdx=270;
              //fdy=100;
              var st="position: absolute;top:"+fdx.toString()+"px;left:"+fdy.toString()+"px;";
              temp.style.cssText=st;
            }
          }
          function key_press()
          {
                  //screen_update();
                  repaint();
                  if(T==0)
                  {
                    var temp1=document.getElementById("onei");
                    temp1.src="image//player1_tank_1_up.png"
                                  //document.getElementById("onep").innerHTML="up";
                    var temp=document.getElementById("onei");
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    temp.style.cssText=st;
                    dir=3;
                  }
                  bmove();
                  if(time_freeze_time+5100>=T&&time_freeze_time!=0)
                  {

                  }
                  else{
                    ai_move();
                  ai_fire();
                  ai_bmove();
                  ai_battle_boom();
                  }
                  
                  creat_food();
                  document.getElementById("life").innerHTML="life:"+life.toString();
                  if(life==0)
                  {
                    if(alert_before==0)
                    {
                      alert("you have lost!");
                      alert_before=1;
                    }
                    else{
                      location.reload();
                    }
                    document.getElementById("lost").innerHTML="You have lost!!!";
                    
                    //console.log("lost");
                    return;
                  }
                  b_boom();
                  if(last==0)
                  {
                    var su=0;
                    for(i=1;i<=num_ai;i++)
                    {
                        if(ai_survive[i])
                        {
                          su++;
                        }
                    }
                    if(su==0)
                    {
                      if(alert_before==0)
                      {
                        alert("you win!");
                        alert_before=1;
                      }
                      else{
                        location.reload();
                      }
                      document.getElementById("lost").innerHTML="You win!!!";
                      
                      return;
                      }
                  }
                  
                  T+=100;
                  
                  ////console.log("move");
                  is_move=0;
                  var prex=x,prey=y;
                  tempkeycode=0;
                 document.addEventListener('keydown',function(e){
                  ////console.log(count.toString());
                  if(e.keyCode == 37){
                   left_move();
                    }
                  else if(e.keyCode == 39){
                    right_move();
                          
                      
                  }else if(e.keyCode == 38){
                    up_move();
                      
                  }else if(e.keyCode == 40){
                    down_move();
                      
                  }else if(e.keyCode == 70){
                    my_fire();
              
                  }
                
  
                 })
              }
          function left_move()
           {
             if(is_move==1)
             {
               return;
             }
             is_move=1;
             var prey=y;
             var mov=true;
             var x1=x,y1=y-12;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                if(y>=12&&mov)
                          {
                            
                            var temp1=document.getElementById("onei");
                            temp1.src="image//player1_tank_1_left.png"
                            y-=12;
                            if(y<0)
                            {
                              y=0;
                            }
                            if(prey-y<=12)
                            {
                            //  document.getElementById("onep").innerHTML="left";
                            var temp=document.getElementById("onei");
                            var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                            temp.style.cssText=st;
                            dir=1;
                            is_move=1;
                           
                            }
                            else{
                              y+=12;
                            }
                          }
                if(mov==false)
                {
                  var temp1=document.getElementById("onei");
                            temp1.src="image//player1_tank_1_left.png"
                            y=Math.floor(y/12)*12;
                            if(y<0)
                            {
                              y=0;
                            }
                            
                              //document.getElementById("onep").innerHTML="left";
                            var temp=document.getElementById("onei");
                            var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                            temp.style.cssText=st;
                            dir=1;
                            is_move=1;
                          
                            
                }
                if(x<=fdx+48&&x>=fdx-24&&y<=fdy+48&&y>=fdy-24)
              {
                p1_eat_food();
              }
           }
           function right_move()
           {
            if(is_move==1)
             {
               return;
             }
             is_move=1;
             var prey=y;
             var mov=true;
             var x1=x,y1=y+12;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                        if(y<=336&&mov)
                        {
                          y+=12;
                          if(y>360)
                          {
                            y=360;
                          }
                          if(y-prey<=12)
                          {
                            var temp1=document.getElementById("onei");
                            temp1.src="image//player1_tank_1_right.png"
                           // document.getElementById("onep").innerHTML="right";
                            var temp=document.getElementById("onei");
                            var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                            temp.style.cssText=st;
                            dir=2;
                        
                            is_move=1;
                          }
                          else{
                            y-=12;
                          }
                        }
                        if(mov==false)
                {
                  var temp1=document.getElementById("onei");
                            temp1.src="image//player1_tank_1_right.png"
                            y=Math.floor(y/12)*12+1;
                            if(y>360)
                            {
                              y=360;
                            }
                            
                              //document.getElementById("onep").innerHTML="right";
                            var temp=document.getElementById("onei");
                            var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                            temp.style.cssText=st;
                            dir=2;
                            is_move=1;
                          
                            
                }
                if(x<=fdx+48&&x>=fdx-24&&y<=fdy+48&&y>=fdy-24)
              {
                p1_eat_food();
              }
          }
          function up_move()
          {
            if(is_move==1)
             {
               return;
             }
             is_move=1;
             var prex=x;
             var mov=true;
             var x1=x-12,y1=y;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                        if(x>=12&&mov)
                        {
                          x-=12;
                          if(x<0)
                          {
                            x=0;
                          }
                          if(prex-x<=12)
                          {
                            var temp1=document.getElementById("onei");
                            temp1.src="image//player1_tank_1_up.png"
                            //document.getElementById("onep").innerHTML="up";
                            var temp=document.getElementById("onei");
                            var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                            temp.style.cssText=st;
                            dir=3
                           
                            is_move=1;
                          }
                          else{
                            x+=12;
                          }
                        }
                        if(mov==false)
                {
                  var temp1=document.getElementById("onei");
                            temp1.src="image//player1_tank_1_up.png"
                            x=Math.floor(x/12)*12;
                            if(x<0)
                            {
                              x=0;
                            }
                            
                              //document.getElementById("onep").innerHTML="up";
                            var temp=document.getElementById("onei");
                            var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                            temp.style.cssText=st;
                            dir=3;
                            is_move=1;
                          
                            
                }
                if(x<=fdx+48&&x>=fdx-24&&y<=fdy+48&&y>=fdy-24)
              {
                p1_eat_food();
              }
          }
          function down_move()
          {
            if(is_move==1)
             {
               return;
             }
             is_move=1;
             var prex=x;
             var mov=true;
             var x1=x+12,y1=y;
                    var ii=Math.floor(x1/12),jj=Math.floor(y1/12);
                    
                    if(now[ii*30+jj]==1||now[ii*30+jj]==2||now[ii*30+jj]==3||now[ii*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=29)
                    if(now[ii*30+jj+1]==1||now[ii*30+jj+1]==2||now[ii*30+jj+1]==3||now[ii*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(jj<=29&&ii<=28)
                    if(now[(ii+1)*30+jj]==1||now[(ii+1)*30+jj]==2||now[(ii+1)*30+jj]==3||now[(ii+1)*30+jj]==4)
                    {
                      mov=false;
                    }
                    if(jj<=28&&ii<=28)
                    if(now[(ii+1)*30+jj+1]==1||now[(ii+1)*30+jj+1]==2||now[(ii+1)*30+jj+1]==3||now[(ii+1)*30+jj+1]==4)
                    {
                      mov=false;
                    }
                    if(x1%12!=0)
                    {
                      if(jj<=28&&ii<=27)
                      if(now[(ii+2)*30+jj+1]==1||now[(ii+2)*30+jj+1]==2||now[(ii+2)*30+jj+1]==3||now[(ii+2)*30+jj+1]==4)
                      {
                        mov=false;
                      }
                      if(jj<=29&&ii<=27)
                      if(now[(ii+2)*30+jj]==1||now[(ii+2)*30+jj]==2||now[(ii+2)*30+jj]==3||now[(ii+2)*30+jj]==4)
                      {
                        mov=false;
                      }
                    }
                    if(y1%12!=0&&jj<=27)
                    {
                      if(jj<=27&&ii<=29)
                      if(now[(ii)*30+jj+2]==1||now[(ii)*30+jj+2]==2||now[(ii)*30+jj+2]==3||now[(ii)*30+jj+2]==4)
                      {
                
                        mov=false;
                      }
                      if(jj<=27&&ii<=28)
                      if(now[(ii+1)*30+jj+2]==1||now[(ii+1)*30+jj+2]==2||now[(ii+1)*30+jj+2]==3||now[(ii+1)*30+jj+2]==4)
                      {
    
                        mov=false;
                      }
                    }
                    if(x1%12!=0&&y1%12!=0)
                    {
                      if(jj<=27&&ii<=27)
                      if(now[(ii+2)*30+jj+2]==1||now[(ii+2)*30+jj+2]==2||now[(ii+2)*30+jj+2]==3||now[(ii+2)*30+jj+2]==4)
                      {
                        mov=false;
                      }
                    }
                    console.log(x.toString()+' '+y.toString()+' '+mov.toString());
                        if(x<=336&&mov)
                        {
                          x+=12;
                          if(x<0)
                          {
                            x=0;
                          }
                          if(x-prex<=12)
                          {
                            var temp1=document.getElementById("onei");
                            temp1.src="image//player1_tank_1_down.png"
                            //document.getElementById("onep").innerHTML="down";
                            var temp=document.getElementById("onei");
                            var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                            temp.style.cssText=st;
                            dir=4;
                           
                            is_move=1;
                          }
                          else{
                            x-=12;
                          }
                          
                        }
                  if(mov==false)
                {
                  var temp1=document.getElementById("onei");
                            temp1.src="image//player1_tank_1_down.png"
                            x=Math.floor(x/12)*12;
                            if(x>=360)
                            {
                              x=360;
                            }
                            
                              //document.getElementById("onep").innerHTML="down";
                            var temp=document.getElementById("onei");
                            var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                            temp.style.cssText=st;
                            dir=4;
                            is_move=1;
                          
                            
                }
              if(x<=fdx+48&&x>=fdx-24&&y<=fdy+48&&y>=fdy-24)
              {
                p1_eat_food();
              }
          }
          function my_fire()
          {
            //document.getElementById("onep").innerHTML="fire";
                      if(is_bullet==true)
                      {
                          
                      }
                      else{
                          
                          is_bullet=true;
                          var temp=document.getElementById("bullet");
                          var X=x,Y=y;
                          if(dir==1)
                          {
                            X+=6;
                            
                          }
                          if(dir==2)
                          {
                            X+=6;
                            Y+=12;
                          }
                          if(dir==3)
                          {
                            Y+=6;
                          }
                          if(dir==4)
                          {
                            Y+=6;
                            X-=12;
                          }
                          //console.log(x.toString()+' '+y.toString()+' '+X.toString()+' '+Y.toString());
                          var st="position: absolute;top:"+X.toString()+"px;left:"+Y.toString()+"px;";
                          temp.style.cssText=st;
                          bx=X;
                          by=Y;
                          bdir=dir;
                          var temp=document.getElementById("bullet");
                          if(dir==1)
                          {
                              temp.src="image//bullet_left.png";
                          }
                          else if(dir==2)
                          {
                              temp.src="image//bullet_right.png";
                          }else if(dir==3)
                          {
                              temp.src="image//bullet_up.png";
                          }else{
                              temp.src="image//bullet_down.png";
                          }
                          
                         
                      }
          }
          function my_ai_move()
          {
            //计算威胁度
            var threat=0,thm=99999999;
            var threat_num=0;
            for(i=1;i<=max_ai_num;i++)
            {
              if(ai_survive[i])
              {
                if(ai_dir[i]==3)
                {
                  threat=Math.abs(ai_y[i]-205)+ai_x[i]+360;
                  
                }
                if(ai_dir[i]==4)
                {
                  threat=Math.abs(ai_y[i]-205)-ai_x[i]+360;
                  
                }
                if(ai_dir[i]==2)
                {
                  if(ai_x[i]>=300)
                  {
                    threat=-1;
                  }
                  threat=Math.abs(ai_y[i]-360)-ai_x[i]+360+205;
                  
                }
                if(ai_dir[i]==1)
                {
                  if(ai_x[i]>=300)
                  {
                    threat=-1;
                  }
                  threat=Math.abs(ai_y[i]-360)-ai_x[i]+360+205;
                }
                console.log(threat);
                if(threat<thm)
                {
                  thm=threat;
                  threat_num=i;
                }
              }
            }
            
              if((ai_x[threat_num]>300&&Math.abs(y22-205)<=Math.abs(ai_y[threat_num]-205))||x22<=150)
              {
                p2_downmove();
              }
              else if(x22>=300)
              {
                p2_upmove();
              }
              else{
                if(ai_y[threat_num]>y22&&y22<300&&Math.abs(ai_y[threat_num]-y22)>=6)
                {
                  p2_rightmove();
                }
                if(ai_y[threat_num]>y22&&y22<300&&Math.abs(ai_y[threat_num]-y22)<6)
                {
                  p2_leftmove();
                }
                else{
                  if(y22>36&&ai_y[threat_num]<y22&&Math.abs(ai_y[threat_num]-y22)>=6)
                    p2_leftmove();
                  if(y22>36&&ai_y[threat_num]<y22&&Math.abs(ai_y[threat_num]-y22)<6)
                    p2_rightmove();
                }
              }
            for(i=1;i<=max_ai_num;i++)
            {
            
              if(dir22==1&&(ai_x[i]>=x22&&ai_dir[i]==3||ai_x[i]<=x22&&ai_dir[i]==4)&&Math.abs(y22-ai_y[i]-Math.abs(x22-ai_x[i])*2)<=12)
              {
                p2_fire();
              }
              if(dir22==2&&(ai_x[i]>=x22&&ai_dir[i]==3||ai_x[i]<=x22&&ai_dir[i]==4)&&Math.abs(ai_y[i]-y22-Math.abs(x22-ai_x[i])*2)<=12)
              {
                p2_fire();
              }
              if(dir22==3&&(ai_y[i]>=y22&&ai_dir[i]==1||ai_y[i]<=y22&&ai_dir[i]==2)&&Math.abs(x22-ai_x[i]-Math.abs(y22-ai_y[i])*2)<=12)
              {
                p2_fire();
              }
              if(dir22==4&&(ai_y[i]>=y22&&ai_dir[i]==3||ai_y[i]<=y22&&ai_dir[i]==4)&&Math.abs(ai_x[i]-x22-Math.abs(y22-ai_y[i])*2)<=12)
              {
                p2_fire();
              }
              //if(ai_dir[threat_num]==1&&)
            }
            for(i=1;i<=max_ai_num;i++)
            {
              if(Math.abs(ai_x[i]-x22)<=12&&(ai_dir[i]==1||ai_dir[i]==2))
              {
                if(ai_y[i]>y22)
                {
                  p2_rightmove();
                  p2_fire();
                }
                if(ai_y[i]<y22)
                {
                  p2_leftmove();
                  p2_fire();
                }
              }
              if(Math.abs(ai_y[i]-y22)<=12&&(ai_dir[i]==3||ai_dir[i]==4))
              {
                if(ai_x[i]>x22)
                {
                  p2_downmove();
                  p2_fire();
                }
                if(ai_x[i]<x22)
                {
                  p2_upmove();
                  p2_fire();
                }
              }
            }
          }
          function key_pressai()
          {
            repaint();
                  if(T==0)
                  {
                    var temp1=document.getElementById("onei");
                    temp1.src="image//player1_tank_1_up.png"
                                  //document.getElementById("onep").innerHTML="up";
                    var temp=document.getElementById("onei");
                    var st="position: absolute;top:"+x.toString()+"px;left:"+y.toString()+"px;";
                    temp.style.cssText=st;
                    dir=3;
                    var temp1=document.getElementById("twoi");
                    temp1.src="image//player2_tank_1_up.png"
                                  //document.getElementById("onep").innerHTML="up";
                    var temp=document.getElementById("twoi");
                    var st="position: absolute;top:"+x22.toString()+"px;left:"+y22.toString()+"px;";
                    temp.style.cssText=st;
                    dir22=3;
                  }
                  bmove();
                  if(time_freeze_time+5100>=T&&time_freeze_time!=0){
                      console.log("freeze:"+time_freeze_time.toString()+'---'+T.toString());
                  }
                  else
                  {
                    ai_movet();
                    ai_fire();
                    ai_bmove();
                    ai_battle_boomt();
                  }
                  console.log('T: '+T.toString());
                  document.getElementById("life").innerHTML="life:"+life.toString();
                  if(life==0&&life2==0)
                  {
                    if(alert_before==0)
                    {
                      //socket.send("alert_lost");
                      alert("you have lost!");
                      alert_before=1;
                      
                    }
                    else{
                      //socket.send("refresh");
                      location.reload();
                    }
                    document.getElementById("lost").innerHTML="You have lost!!!";
                    
                    //console.log("lost");
                    return;
                  }
                  b_boom();
                  if(last==0)
                  {
                    var su=0;
                    for(i=1;i<=num_ai;i++)
                    {
                        if(ai_survive[i])
                        {
                          su++;
                        }
                    }
                    if(su==0)
                    {
                      if(alert_before==0)
                      {
                        alert("you win!");
                        alert_before=1;
                      }
                      else{
                        location.reload();
                      }
                      document.getElementById("lost").innerHTML="You win!!!";
                      
                      return;
                      }
                  }
                  
                  creat_food();
                  
                  //send_data();
                 // receive();
                  my_ai_move();
                  bmove2();
                  bboom2();
                  T+=100;
                  ////console.log("move");
                  is_move=0;
                  var prex=x,prey=y;
                  tempkeycode=0;
                 document.addEventListener('keydown',function(e){
                  ////console.log(count.toString());
                  if(e.keyCode == 37){
                   left_move();
                    }
                  else if(e.keyCode == 39){
                    right_move();
                          
                      
                  }else if(e.keyCode == 38){
                    up_move();
                      
                  }else if(e.keyCode == 40){
                    down_move();
                      
                  }else if(e.keyCode == 70){
                    my_fire();
              
                  }
                
  
                 })
              }
          function change_positionai()
          {
            document.getElementById("button1").style.display="none";
            document.getElementById("button2").style.display="none";
            document.getElementById("button3").style.display="none";
            document.getElementById("buttont").style.display="none";
            document.getElementById("buttonai").style.display="none";
            document.getElementById("passport").style.display="none";
            document.getElementById("room").style.display="none";
            max_ai_num=3;
            alert_before=0;
            life=100;
            var audio1=document.getElementById("start");
            audio1.play();
            
            var random_audio=Math.floor(Math.random() * (4 - 1));
            if(random_audio==0)
            {
              var audio2=document.getElementById("bg1");
              audio2.play();
            }
            if(random_audio==1)
            {
              var audio2=document.getElementById("bg2");
              audio2.play();
            }
            if(random_audio==2)
            {
              var audio2=document.getElementById("bg3");
              audio2.play();
            }
            setInterval(key_pressai,100);
            if(life==0)
            {
              location.reload();
              return;
            }
        }
    
  </script>
  </html>
  
